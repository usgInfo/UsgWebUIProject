/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
var numberofRows = 0;
var autogeneratednumber1;
function UnPostingVoucherMaster1(divId)
{
    var financialYear = getUserSessionElement(seCurrentFinancialYear);
    $("#dashboardOrderListId").text("").append('<a href="javascript:void(0)" data-toggle="tab" onclick="displayFinanceHorizontalBar()">Financial Management</a> > <a href="javascript:void(0)" data-toggle="tab" onclick="financeTransactionMenuTabs()">Transaction Master</a> > <a href="javascript:void(0)" data-toggle="tab" onclick="UnPostingVoucherMaster1()">Voucher UnPosting</a>');

    $("#dashboardBodyMainDiv").text("").append('<div id="voucherUnPostingDivId"></div>');
    $("#voucherUnPostingDivId").text("").append('<div id="voucherUnPostingTabMenu" />');

    $("#voucherUnPostingTabMenu").append('<div id="voucherUnPostingMainMenu" class="row" />');
    $("#voucherUnPostingTabMenu").append('<div id="voucherUnPostingListMainMenu" class="row" />');
    if (checkUserPrivelege(pvViewVoucherUnPosting)) {
        $("#voucherUnPostingMainMenu").append('<div id="voucherUnPostingMainPanel" class="panel panel-blue" />');
        $("#voucherUnPostingMainPanel").append('<div id="voucherUnPostingMainHeading" class="panel-heading" />');
        $("#voucherUnPostingMainHeading").append('<div class="panel-title" a data-toggle="collapse" style="font-weight:bold;font-size:15px;" data-parent="#accordion2" href="#collapseOne1"><center>Voucher UnPosting</center><div class="pull-right" style="position: relative;bottom: 15px;cursor:pointer;" id="voucherUnpostinhColDiv"><span class="glyphicon glyphicon-minus-sign"></span></div></div>');
        $("#voucherUnPostingMainPanel").append('<div id="collapseOne1" class="panel-collapse collapse in" />');
        $("#voucherUnpostinhColDiv").click(function () {
            $("#collapseOne1").toggle();
            if ($("#voucherUnpostinhColDiv span").hasClass("glyphicon-minus-sign")) {
                $("#voucherUnpostinhColDiv").text("").append("<span class='glyphicon glyphicon-plus-sign'></span>");
            } else {
                $("#voucherUnpostinhColDiv").text("").append("<span class='glyphicon glyphicon-minus-sign'></span>");
            }
        });
        $("#collapseOne1").append('<div id="voucherUnPostingMainBody" class = "panel-body" />');
        $("#voucherUnPostingMainBody").append('<div id="panelRow" class="form-horizontal" />');

        $("#voucherUnPostingMainBody").append('<center><span id="voucherUnPostingMessageDiv"></span></center>');
        $("#voucherUnPostingMainBody").append('<div id="voucherUnPostingBodyDiv" class="row" />');
        $("#voucherUnPostingBodyDiv").append("<span class='pull-right' style='font-size: 15px;'><strong>Financial Year : " + financialYear + "</strong></span>");

        $("#voucherUnPostingBodyDiv").append("<input type='hidden' id='saveorupdate' value='save'>");
        $("#voucherUnPostingBodyDiv").append('<div class="col-lg-12"><div class="form-group col-lg-6"><label for="ddo">DDO </label><select class="form-control" name="ddo" id="DDO" onchange=getLocationBasedOnDDOInReceiptVoucher()></select>'
                + '</div><div class="form-group col-lg-6"><label for="location">Location </label><select class="form-control" id="location"></select></div></div>');
        $("#voucherUnPostingBodyDiv").append('<div class="col-lg-12"><div class="form-group col-lg-6"><label for="fundType">Fund Type </label><select class="form-control" name="fundType" id="fundType"></select>'
                + '</div><div class="form-group col-lg-6"><label for="budgetHead">Budget Head </label><select class="form-control" id="budgetHead"></select></div></div>');
        $("#voucherUnPostingBodyDiv").append('<div class="col-lg-12"><div class="form-group col-lg-6"><label for="manualVoucherNumber">Manual Voucher Number</label><input type="text" class="form-control" name="manualVoucherNo" id="manualVoucherNo" onkeypress="return validateNumber(event)" >'
                + '</div><div class="form-group col-lg-6"><label for="voucherAmount">Voucher Amount </label><input type="text" class="form-control" id="voucherAmount"></div></div>');

        $("#voucherUnPostingBodyDiv").append('<div class="col-lg-12"><div class="form-group col-lg-6"><label for="fromDate">From Date<span class="require">*</span> </label><input type="text" class="form-control" id="fromDate" placeholder="MM/DD/YYYY"><span id="fromDateErr" class="text-danger"></span></div>'
                + '<div class="form-group col-lg-6"><label for="toDate">To Date <span class="require">*</span><span id="toDateErr" class="text-danger"></span></label><input type="text" class="form-control" id="toDate" placeholder="MM/DD/YYYY"></div></div>');
//        $("#fromDate").datepicker({
//            changeYear: true,
//            changeMonth: true,
//            dateFormat: "dd/mm/yy",
//            yearRange: '-0:+50',
//            minDate: '+0D'
//        });
//
//        $("#toDate").datepicker({
//            changeYear: true,
//            changeMonth: true,
//            dateFormat: "dd/mm/yy",
//            yearRange: '-0:+50',
//            minDate: '+0D'
//        });
var currentFinancialYear = getUserSessionElement(seCurrentFinancialYear);
    var toFinacialYear = null;
    if (currentFinancialYear != null || currentFinancialYear != "" || currentFinancialYear != undefined)
    {
        var finyearArray = currentFinancialYear.split("~");
    }
    if (finyearArray != null || finyearArray != "" || finyearArray != undefined)
    {
        var fromFinacialYear = finyearArray[0];
        var toFinacialYear = finyearArray[1];

        $("#fromFinancialYear").val(fromFinacialYear);
        $("#toFinancialYear").val(toFinacialYear);

    }
    $("#currentFinancialYear").val(currentFinancialYear);
    $('#fromDate').datepicker({
        changeYear: true,
        changeMonth: true,
        startDate: fromFinacialYear,
        endDate: toFinacialYear
    });
        
        $('#toDate').datepicker({
            changeYear: true,
            changeMonth: true,
            startDate: fromFinacialYear,
            endDate: toFinacialYear
        });
        $("#fromDate").keypress(function (event) {
            event.preventDefault();
        });
        $("#toDate").keypress(function (event) {
            event.preventDefault();
        });
        $("#voucherUnPostingBodyDiv").append('<div class="col-lg-12"><div class="form-group col-lg-6"><label for="voucherType">Voucher Type<span class="require">*</span></label><select class="form-control" name="voucherType" id="voucherType"></select><span id="voucherTypeErr" class="text-danger"></span>'
                + '</div><div class="form-group col-lg-6"><label for="totalRecords">Total No. of Records </label><input type="text" class="form-control" id="totalNoOfRecords"></div></div>');
        $("#voucherUnPostingBodyDiv").append("<div class='form-group' id='changeButton'><center><button onclick=viewUnPostingVoucherListMaster() id='postSearch' class='btn btn-success' style='height:40px;width:80px'>Search</button>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<button id='resetButton' onclick=resetPostingVoucherList('voucherUnPostingMainBody') class='btn btn-warning' style='height:40px;width:80px'>Reset</button></center></div>");

        $("#voucherUnPostingListMainMenu").text("").append('<div id="voucherUnPostingListPanel" class="panel panel-blue" />');
        $("#voucherUnPostingListPanel").append('<div id="voucherUnPostingListHeading" class="panel-heading" />');
        $("#voucherUnPostingListHeading").append('<div class="panel-title" a data-toggle="collapse" style="font-weight:bold;font-size:15px;" data-parent="#accordion2" href="#collapseOne2"><center>List of UnPosted Voucher(s)</center><div class="pull-right" style="position: relative;bottom: 15px;cursor:pointer;" id="voucherUnpostingListColDiv"><span class="glyphicon glyphicon-minus-sign"></span></div></div>');
//voucherUnpostingListColDiv
        $("#voucherUnPostingListPanel").append('<div id="collapseOne2" class="panel-collapse collapse in pal" />');
        $("#voucherUnpostingListColDiv").click(function () {
            $("#collapseOne2").toggle();
            if ($("#voucherUnpostingListColDiv span").hasClass("glyphicon-minus-sign")) {
                $("#voucherUnpostingListColDiv").text("").append("<span class='glyphicon glyphicon-plus-sign'></span>");
            } else {
                $("#voucherUnpostingListColDiv").text("").append("<span class='glyphicon glyphicon-minus-sign'></span>");
            }
        });
        $("#collapseOne2").append("<div id='listpanelMainBody' class = 'panel-body' />");
        $("#listpanelMainBody").append("<div id='listpanelRow' class='row' />");

        $("#listpanelMainBody").append("<div id='pregresssuccessBefore'>");
        $("#listpanelRow").append("<div id='ErrorMessageDiv'  />");
        $("#listpanelRow").append("<div id='voucherUnPostlistpanelRow' class='table-responsive' />");

        var voucherTypeOptions = ["Receipt-Voucher", "Payment-Voucher", "Contra-Voucher", "Journal-Voucher"];
        getHardCodedOptions("voucherType", "Voucher Type", voucherTypeOptions);

//    setTimeout(function () {
//        getDDOforReceiptVoucher("", "DDO");
//    }, 200);

        setTimeout(function () {
            viewOptionIdName("budget/master/FundType/View", "", "description", "fundType", "Fund Type");
        }, 200);

        setTimeout(function () {
            viewOptionIdName("hrms/common/BudgetHead/View", "", "budgetHead", "budgetHead", "Budget Head");
        }, 300);

        getLoggedInDDOLocationInDropDown("DDO", "location");
    }

}
function resetPostingVoucherList() {
    $("#ListPanel234").text("");
    $("#voucherType").val("");
    $("#fromDate").val("");
    $("#toDate").val("");
    $("#fundType").val("");
    $("#budgetHead").val("");
    $("#manualVoucherNo").val("");
    $("#voucherAmount").val("");
    $("#totalNoOfRecords").val("");


}
function UnPostingVoucherValidation() {
    var result = 1;
    var voucherType = $("#voucherType").val();
    var fromDate = $("#fromDate").val();
    var toDate = $("#toDate").val();
    var DDO = $("#DDO").val();
    var fundType = $("#fundType").val();
    var budgetHead = $("#budgetHead").val();
    var manualVoucherNo = $("#manualVoucherNo").val();
    var voucherAmount = $("#voucherAmount").val();
    if (voucherType == null || voucherType == "") {
        $("#voucherType").focus();
        displaySmallErrorMessages("voucherTypeErr", "Please Select Voucher Type");
        result = 0;
    } else if (voucherType != null || voucherType != "") {
        $("#voucherTypeErr").text("");
    }
    if (fromDate == null || fromDate == "") {
        $("#fromDate").focus();
        displaySmallErrorMessages("fromDateErr", "Please Enter From Date");
        result = 0;
    } else if (fromDate != null || fromDate != "") {
        $("#fromDateErr").text("");
    }
    if (toDate == null || toDate == "") {
        $("#fromDate").focus();
        displaySmallErrorMessages("toDateErr", "Please Enter To Date");
        result = 0;
    } else if (toDate != null || toDate != "") {
        $("#toDateErr").text("");
    }

    if (result != 0) {
        SearchUnPostingVoucherDetails();
    }
}

function SearchUnPostingVoucherDetails() {
    var voucherType = $("#voucherType").val();
    var fromDate = $("#fromDate").val();
    var toDate = $("#toDate").val();
    var DDO = $("#DDO").val();
    var fundType = $("#fundType").val();
    var budgetHead = $("#budgetHead").val();
    var manualVoucherNo = $("#manualVoucherNo").val();
    var voucherAmount = $("#voucherAmount").val();

    $.post(server_base_url + "financial/transaction/ReceiptVoucher/Save", {
        receiptvoucherJson: JSON.stringify(receiptVoucherJson),
        userid: sessionStorage.getItem("userId")
    }).done(function (bdata) {
        if (bdata == fail) {
            displayErrorMessages("pregsuccessBefore", "Invalid username / password" + "");
        } else if (bdata == unauthorized || bdata.statuscode == unauthorized) {
            displayErrorMessages("pregsuccessBefore", unauthorizedMessage + "");
        } else if (bdata == statusException) {
            displayErrorMessages("pregsuccessBefore", statusExceptionMessage + "");
        } else if (bdata == invalidSession) {
            callSessionTimeout();
        } else if (bdata == null) {
            displayErrorMessages("pregsuccessBefore", "No User available" + "");
        } else {
            for (var i = bdata.length - 1; i >= 0; i--) {
                sno++;
                var objjson = {
                    objId: bdata[i]._id.$oid,
                    voucherNo: bdata[i].voucherNo,
                    voucherDate: bdata[i].voucherDate,
                    fundType: bdata[i].fundType,
                    budgetHead: bdata[i].budgetHead,
                    ledgerCategory: bdata[i].ledgerCategory,
                    isGrant: bdata[i].isGrant,
                    ledgerList: bdata[i].ledgerList,
                    totalDrAmount: bdata[i].totalDrAmount,
                    totalCrAmount: bdata[i].totalCrAmount,
                    narration: bdata[i].narration,
                    paymentMode: bdata[i].paymentMode,
                    chequeNo: bdata[i].chequeNo,
                    chequeDate: bdata[i].chequeDate,
                    chequeBankName: bdata[i].chequeBankName,
                    chequeAmount: bdata[i].chequeAmount,
                    inFavorOf: bdata[i].inFavorOf,
                    chequeRemarks: bdata[i].chequeRemarks,
                    bankAccountNo: bdata[i].bankAccountNo,
                    bankName: bdata[i].bankName,
                    bankAmount: bdata[i].bankAmount,
                    bankRemarkst: bdata[i].bankRemarkst
                };
                objjson = JSON.stringify(objjson);
                var sno = 0;

                $("#displayListOfUnPostedVouchersTableBody").append("<tr id='" + bdata[i].status + "' style='cursor:pointer;' >"
                        + "<td>" + ++sno + "</td>"
                        + "<td style='cursor:pointer;'>CB/RV-" + bdata[i].voucherNo + "</td>"
                        + "<td style='cursor:pointer;'>" + bdata[i].fundType + "</td>"
                        + "<td style='cursor:pointer;'>" + bdata[i].totalDrAmount + "</td>"
                        + "<td style='cursor:pointer;'>" + bdata[i].totalCrAmount + "</td>"
                        + "<td style='cursor:pointer;'>" + bdata[i].paymentMode + "</td>"
                        + "<td style='cursor:pointer;' onclick=updateReceiptVoucher('" + encodeURI(objjson) + "')>" + ' <button type="button"  class="btn btn-primary mr5"style="align:center;color:white"  >EDIT</button>' + "</td>"
                        + "<td onclick=deleteReceiptVoucher('" + bdata[i]._id.$oid + "')>" + ' <button type="button" class="btn btn-danger mr5"  style="align:center;color:white" >DELETE</button>' + "</td></tr>");
            }
        }
    });
}

function viewUnPostingVoucherListMaster() {
    if (checkUserPrivelege(pvViewVoucherUnPosting)) {

        $("#voucherUnPostlistpanelRow").text("").append("<div class='tab-pane' id='viewUser'/>");
        $("#viewUser").append("<div class='table-responsive' id='viewUserSectionTableDiv' />");
        $("#viewUserSectionTableDiv").append("<table class='table table-bordered table-warning mb30' id='displayListOfUnPostedVouchersTable' />");
        $("#displayListOfUnPostedVouchersTable").append("<thead class=''><tr>"

                + " <th> S.No</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Voucher Number</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Voucher Date</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Fund Type</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Budget Head</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Voucher Amount</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Voucher Type</th>"
                + "<th style='min-width:30%;width:auto;'><i ></i>Narration</th>"
                + "<th style='min-width:1%;width:80px;''><i class='fa'></i>View</th>"
                + "</tr></thead>");

        var result = 1;
        var voucherType = $("#voucherType").val();
        var fromDate = $("#fromDate").val();
        var toDate = $("#toDate").val();
        var DDO = $("#DDO").val();
        var location = $("#location").val();
        var fundType = $("#fundType").val();
        var budgetHead = $("#budgetHead").val();
        var manualVoucherNo = $("#manualVoucherNo").val();
        var voucherAmount = $("#voucherAmount").val();
        if (voucherType == null || voucherType == "") {
            $("#voucherType").focus();
            displaySmallErrorMessages("voucherTypeErr", "Please Select Voucher Type");
            result = 0;
        } else if (voucherType != null || voucherType != "") {
            $("#voucherTypeErr").text("");
        }
        if (fromDate == null || fromDate == "") {
            $("#fromDate").focus();
            displaySmallErrorMessages("fromDateErr", "Please Enter From Date");
            result = 0;
        } else if (fromDate != null || fromDate != "") {
            $("#fromDateErr").text("");
        }
        if (toDate == null || toDate == "") {
            $("#fromDate").focus();
            displaySmallErrorMessages("toDateErr", "Please Enter To Date");
            result = 0;
        } else if (toDate != null || toDate != "") {
            $("#toDateErr").text("");
        }
        var noOfDays = checkFromDateAndToDateCashBookReport();
        if (noOfDays < 0) {
            displaySmallErrorMessages("toDateErr", "To Date should be greater than or equal to From Date");
            result = 0;
        } else {
            $.get(server_base_url + "financial/transaction/VoucherUnPosting/Search", {
                voucherType: voucherType,
                fromDate: fromDate,
                toDate: toDate,
                DDO: DDO,
                location: location,
                fundType: fundType,
                budgetHead: budgetHead,
                manualVoucherNo: manualVoucherNo,
                voucherAmount: voucherAmount
            }).done(function (bdata) {

                if (bdata == fail) {
                    displayErrorMessages("ErrorMessageDiv", "No Data Available.." + "");
                } else if (bdata == unauthorized || bdata.statuscode == unauthorized) {
                    displayErrorMessages("ErrorMessageDiv", unauthorizedMessage + "");
                } else if (bdata == statusException) {
                    displayErrorMessages("ErrorMessageDiv", statusExceptionMessage + "");

                } else {
                    if (bdata != null) {
                        if (bdata.length > 0) {
                            var sno = 0;
                            $("#displayListOfUnPostedVouchersTable").append("<tbody id='displayListOfUnPostedVouchersTableBody' class='table-striped table-bordered' />");
//                    for (var i = 0; i < bdata.length; i++) {
                            for (var i = bdata.length - 1; i >= 0; i--) {
                                sno++;
                                var obj = bdata[i].value;
                                var objjson = {
                                    objId: obj._id,
                                    DDO: obj.DDO,
                                    ddoName: obj.ddoName,
                                    location: obj.location,
                                    locationName: obj.locationName,
                                    manualVoucherNo: obj.manualVoucher,
                                    voucherNo: obj.voucherNo,
                                    voucherDate: obj.voucherDate,
                                    fundType: obj.fundType,
                                    budgetHead: obj.budgetHeadName,
                                    ledgerCategory: obj.ledgerCategory,
                                    isGrant: obj.isGrant,
                                    ledgerList: obj.ledgerList,
                                    totalDrAmount: obj.totalDrAmount,
                                    totalCrAmount: obj.totalCrAmount,
                                    narration: obj.narration,
                                    paymentMode: obj.paymentMode,
                                    chequeList: obj.chequeList,
                                    bankPaymentList: obj.bankPaymentList,
                                    instrumentNo: obj.instrumentNo,
                                    instrumentDate: obj.instrumentDate,
                                    instrumentBankName: obj.instrumentBankName,
                                    instrumentAmount: obj.instrumentAmount,
                                    instrumentRemarks: obj.instrumentRemarks,
                                    voucherName: obj.voucherName,
                                    forLocation: obj.forLocation,
                                    createDate: obj.createDate,
                                    createdBy: obj.createdBy,
                                    status: obj.status,
                                    postingStatus: "new"
                                };
                                if (voucherType == "Journal-Voucher") {
                                    budgetHead = obj.budgetHead;
                                }
                                objjson = JSON.stringify(objjson);
                                $("#voucherUnPostingMainMenu").append("<div id='ListPanel234' />");
                                $("#displayListOfUnPostedVouchersTableBody").append("<tr id='" + obj._id + "' style='cursor:pointer;' >"
                                        + "<td>" + sno + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.voucherNo + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.voucherDate + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.fundType + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.budgetHeadName + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.totalDrAmount + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.voucherName + "</td>"
                                        + "<td style='cursor:pointer;'>" + obj.narration + "</td>");
                                if (checkUserPrivelege(pvVoucherUnPostingDetails)) {
                                    $("#" + obj._id).append("<td style='cursor:pointer;' onclick=viewDetailsOfVoucherToUnPost('" + encodeURI(objjson) + "','ListPanel234')>" + ' <button type="button"  class="btn btn-success" style="align:center;color:white"  >View Details</button>' + "</td>");
                                }
                            }
                            $('#displayListOfUnPostedVouchersTable').dataTable();
                            $("#ListPanel234").text("");
                            $("#ErrorMessageDiv").text("");
                        }
                    }
                }
            });
        }
    }
}

function  viewDetailsOfVoucherToUnPost(obj, DivId) {
    if (checkUserPrivelege(pvVoucherUnPostingDetails)) {
        var objectValue = obj;

        obj = decodeURI(obj);
        obj = JSON.parse(obj);

        $("#displayListOfUnPostedVouchersTable tr").css("background-color", "white");
        $("#displayListOfUnPostedVouchersTable tr" + "#" + obj.objId).css("background-color", "rgba(10, 129, 156, 0.3)");


//    $("#tableHeader").append("<div id='ListPanel234' />");
        $("#" + DivId).text("").append("<h4 style='color:red'><center><u><b>Voucher Details</b></u> </center></h4><br><div id='row1' class='row'>");
        $("#row1").append("<div class='col-sm-2'/><label class='col-sm-2'><b>DDO</b></label><label class='col-sm-2'>" + obj.ddoName + "</label>");
        $("#row1").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Location</b></label><label class='col-sm-2'>" + obj.locationName + "</label>");
        $("#ListPanel234").append("<div id='row2' class='row'>");
        $("#row2").append("<div class='col-sm-2'/><label class='col-sm-2'><b>Voucher No.</b></label><label class='col-sm-2'>" + obj.voucherNo + "</label>");
        $("#row2").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Manual Voucher No.</b></label><label class='col-sm-2'>" + obj.manualVoucherNo + "</label>");
        $("#ListPanel234").append("<div id='row3' class='row'>");
        $("#row3").append("<div class='col-sm-2'/><label class='col-sm-2'><b>Voucher Name</b></label><label class='col-sm-2'>" + obj.voucherName + "</label>");
        $("#row3").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Voucher Date</b></label><label class='col-sm-2'>" + obj.voucherDate + "</label>");
        $("#ListPanel234").append("<div id='row4' class='row'>");
//    $("#row4").append("<div class='col-sm-2'/><label class='col-sm-2'>Posting Date</label><label class='col-sm-2'>" + obj.voucherNo + "</label>");
//    $("#row4").append("<div class='col-sm-1'/><label class='col-sm-2'>Fund Type</label><label class='col-sm-2'>" + obj.fundType + "</label>");
        $("#row4").append("<div class='col-sm-2'/><label class='col-sm-2'><b>UnPosting Date</b></label><label class='col-sm-2'><input  type='text' style='width:88px' name='postingDate'  id='postingDate' 'onkeydown='return false;'></input></label>");
        $("#row4").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Fund Type</b></label><label class='col-sm-2'>" + obj.fundType + "</label>");
//      $("#postingDate").datepicker({
//        format: "dd/mm/yyyy",
//        autoclose: true
//    });
        $("#postingDate").datepicker().datepicker("setDate", new Date());

        $("#ListPanel234").append("<div id='row5' class='row'>");
        $("#row5").append("<div class='col-sm-2'/><label class='col-sm-2'><b>Budget Head</b></label><label class='col-sm-2'>" + obj.budgetHead + "</label>");
        $("#row5").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Ledger Category</b></label><label class='col-sm-2'>" + obj.ledgerCategory + "</label>");
        $("#ListPanel234").append("<div id='row6' class='row'>");
        $("#row6").append("<div class='col-sm-2'/><label class='col-sm-2'><b>Voucher Amount</b></label><label class='col-sm-2'>" + obj.totalDrAmount + "</label>");
        //$("#row6").append("<div class='col-sm-1'/><label class='col-sm-2'>Narration</label><label class='col-sm-2'>" + obj.narration + "</label>");
        $("#row6").append("<div class='col-sm-1'/><label class='col-sm-2'><b>Narration</b> </label><textarea  readonly >" + obj.narration + "</textarea>");
        $("#ListPanel234").append("<div id='row7' class='row'>");
        $("#row7").append("<div id='row7_1' class='col-sm-1'>");
        $("#row7").append("<div id='row7_2' class='col-sm-10'>");

        $("#row7_2").append("<div id='panelRowForTable' class='row' />");
        $("#panelRowForTable").append("<div id='PaymentVoucherListAddPanel' class='panel panel-blue' />");
        $("#PaymentVoucherListAddPanel").append("<div id='PaymentVoucherListAddPanelHeading' class='panel-heading' />");
        $("#PaymentVoucherListAddPanelHeading").append("<h4 id='firstHeaderOfPaymentVoucherListAdd' class='panel-title' />");
        $("#firstHeaderOfPaymentVoucherListAdd").append("<class='panel-title' a data-toggle='collapse' style='font-weight:bold;font-size:15px;' data-parent='#accordion2' href='#collapseOne31'><center>List of Ledger Amount Deatils  </center>");
        $("#PaymentVoucherListAddPanel").append("<div id='collapseOne31' class='panel-collapse collapse in' />");
        $("#collapseOne31").append("<div id='paymentVoucherListAddlistpanelMainBody' class = 'panel-body' />");
        $("#paymentVoucherListAddlistpanelMainBody").append("<div id='paymentVoucherlistAddpanelRow' class='row' />");
        viewUnPostingVoucherAddList('paymentVoucherlistAddpanelRow');
        addUnPostingVoucherRows("displayPaymentVoucherAddTableBody", obj.ledgerList);

        $("#ListPanel234").append("<div id='row8' class='row'>");
        $("#row8").append("<div id='row8_1' class='col-lg-6'>");
        $("#row8").append("<div id='row8_2' class='col-lg-6'>");

        $("#row8_1").append("<div id='panelRowForListofCheque' />");
        $("#panelRowForListofCheque").append("<div id='ReceiptVoucherPaymentListAddPanel' class='panel panel-blue' />");
        $("#ReceiptVoucherPaymentListAddPanel").append("<div id='ReceiptVoucherPaymentListAddPanelHeading' class='panel-heading' />");
        $("#ReceiptVoucherPaymentListAddPanelHeading").append("<h4 id='firstHeaderOfReceiptVoucherPaymentListAdd1' class='panel-title' />");
        $("#firstHeaderOfReceiptVoucherPaymentListAdd1").append("<div  style='font-weight:bold;font-size:15px;' ><center>List of Cheque Payment</center></div>");
        $("#panelRowForListofCheque").append("<div id='listpanelBodys' class = 'panel-body' />");
        $("#listpanelBodys").append("<div id='pregsuccessBeforelist'></div>");


        $("#row8_2").append("<div id='panelRowForListofBank' class='row'/>");
        $("#panelRowForListofBank").append("<div id='ReceiptVoucherPaymentListAddPanel1' class='panel panel-blue' />");
        $("#ReceiptVoucherPaymentListAddPanel1").append("<div id='ReceiptVoucherPaymentListAddPanelHeading1' class='panel-heading' />");
        $("#ReceiptVoucherPaymentListAddPanelHeading1").append("<h4 id='firstHeaderOfReceiptVoucherPaymentListAdd2' class='panel-title' />");
        $("#firstHeaderOfReceiptVoucherPaymentListAdd2").append("<div  style='font-weight:bold;font-size:15px;' ><center>List of Bank Payment</center></div>");
        $("#panelRowForListofBank").append("<div id='listpanelMainBodys2' class = 'panel-body' />");
        $("#listpanelMainBodys2").append("<div id='pregsuccessBeforelist2'></div>");

        viewchequeDetailsAddList('listpanelBodys');
        viewBankDetailsAddList('listpanelMainBodys2');
        addChequeDetailsVoucherRows('displayPaymentTableBody1', obj.chequeList);
        addBankDetailsVoucherRows('displayPaymentTableBody2', obj.bankPaymentList);

        $("#ListPanel234").append("<div id='row9' class='row'>");
        if (checkUserPrivelege(pvSaveVoucherUnPosting)) {
            $("#row9").append("<div  class='col-xs-12' /><center><button type='button'  value='Save' style='margin-bottom:15px' class='btn btn-success pull-center' onclick=UnpostThisVoucher('" + objectValue + "')>UnPost Selected Voucher</button></center></div>");
        }
        $("#row9").append("");
    }
}

function  viewUnPostingVoucherAddList(DivId) {
    $("#" + DivId).text("").append("<div class='tab-pane' id='viewPaymentVoucherAdd'/>");
    $("#viewPaymentVoucherAdd").append("<div class='table-responsive' id='viewPaymentVoucherAddTableDiv' />");
    $("#viewPaymentVoucherAddTableDiv").append("<table class='table table-bordered table-striped table-warning mb30' id='displayPaymentVoucherAddTable' />");
    $("#displayPaymentVoucherAddTable").append("<thead class=''><tr>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Sl No.</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Dr/Cr</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Group</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Particulars</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Dr Amount</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Cr Amount</th>"
            + "<th style='min-width:30%;width:auto;'><i class='fa'></i>Short Narration</th>"
            + "</tr></thead>");
    $("#displayPaymentVoucherAddTable").append("<tbody id='displayPaymentVoucherAddTableBody' class='table-striped table-bordered' />");
}
function  viewchequeDetailsAddListForUnPost(DivId) {
    $("#rowOfChequeDetails2").append("<div id='chequeDetailsPanel' class='panel panel-blue' />");
    $("#chequeDetailsPanel").append("<div id='chequeDetailsPanelHeading' class='panel-heading' />");
    $("#chequeDetailsPanelHeading").append("<h4 id='chequeDetailsPanelHeader1' class='panel-title' />");
    $("#chequeDetailsPanelHeader1").append("<class='panel-title' a data-toggle='collapse' style='font-weight:bold;font-size:15px;' data-parent='#accordion2' href='#collapseOne3'><center>Cheque Details</center>");
    $("#chequeDetailsPanel").append("<div id='collapseOne3abc' class='panel-collapse collapse in' />");
    $("#collapseOne3abc").append("<div id='chequeDetailsPanelBody' class = 'panel-body' />");
    $("#chequeDetailsPanelBody").append("<div id='chequedetailsRowforTable' class='row' />");

    $("#chequedetailsRowforTable").text("").append("<div class='tab-pane' id='viewcheqList'/>");
    $("#viewcheqList").append("<div class='table-responsive' id='viewcheqListTableDiv' />");
    $("#viewcheqListTableDiv").append("<table class='table table-bordered table-striped table-warning mb30' id='displayOfChequeDetailsTable' />");
    $("#displayOfChequeDetailsTable").append("<thead class=''><tr>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Cheque No</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Cheque Date</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Cheque Bank Name</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Amount</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>In Favor of</th>"
            + "<th style='min-width:30%;width:auto;'><i class='fa'></i>Remarks</th>"
            + "</tr></thead>");
    $("#displayOfChequeDetailsTable").append("<tbody id='displayChequeDetailsVoucherAddTableBody' class='table-striped table-bordered' />");
}

function  viewBankDetailsAddListToUnPost(DivId) {
    $("#rowOfChequeDetails2").append("<div id='chequeDetailsPanel' class='panel panel-blue' />");

    $("#chequeDetailsPanel").append("<div id='chequeDetailsPanelHeading' class='panel-heading' />");
    $("#chequeDetailsPanelHeading").append("<h4 id='chequeDetailsPanelHeader1' class='panel-title' />");
    $("#chequeDetailsPanelHeader1").append("<class='panel-title' a data-toggle='collapse' style='font-weight:bold;font-size:15px;' data-parent='#accordion2' href='#collapseOne3'><center>Bank Details</center>");
    $("#chequeDetailsPanel").append("<div id='collapseOne3abc' class='panel-collapse collapse in' />");
    $("#collapseOne3abc").append("<div id='chequeDetailsPanelBody' class = 'panel-body' />");
    $("#chequeDetailsPanelBody").append("<div id='chequedetailsRowforTable' class='row' />");

    $("#chequedetailsRowforTable").text("").append("<div class='tab-pane' id='viewcheqList'/>");
    $("#viewcheqList").append("<div class='table-responsive' id='viewcheqListTableDiv' />");
    $("#viewcheqListTableDiv").append("<table class='table table-bordered table-striped table-warning mb30' id='displayOfChequeDetailsTable' />");
    $("#displayOfChequeDetailsTable").append("<thead class=''><tr>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Bank Name</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Account Number</th>"
            + "<th style='min-width:30%;width:auto;'><i ></i>Amount</th>"
            + "<th style='min-width:30%;width:auto;'><i class='fa'></i>Remarks</th>"
            + "</tr></thead>");
    $("#displayOfChequeDetailsTable").append("<tbody id='displayChequeDetailsVoucherAddTableBody' class='table-striped table-bordered' />");
}

function addUnPostingVoucherRows(DivId, ledgerList)
{
    if (ledgerList != null) {
        for (var i = 0; i < ledgerList.length; i++) {
            var groupId = 'group' + i;
            var ledgerId = 'ledger' + i;
            var drAmountId = 'drAmount' + i;
            var crAmountId = 'crAmount' + i;
            var drCrId = 'drCrId' + i;
            var j = i + 1;
            $("#" + DivId).append("<tr style='cursor:pointer;' >"
                    + "<td style='cursor:pointer;'>" + j + "</td>"
                    + "<td style='cursor:pointer;'><label   id='" + drCrId + "' >" + ledgerList[i].DrCr + "</select></td>"
                    + "<td style='cursor:pointer;'><label>" + ledgerList[i].groupName + "</label></td>"
                    + "<td style='cursor:pointer;'><label>" + ledgerList[i].ledgerName + "</label></td>"
                    + "<td style='cursor:pointer;'><label> " + ledgerList[i].drAmount + "</label></td>"
                    + "<td style='cursor:pointer;'><label> " + ledgerList[i].crAmount + "</label></td>"
                    + "<td style='cursor:pointer;'><label> " + ledgerList[i].shortNarration + "</label></td>"
                    + "</tr></thead>");
        }
    }
}

function addChequeDetailsVoucherRowsForUnPost(DivId, obj)
{
    obj = decodeURI(obj);
    obj = JSON.parse(obj);
    if (obj != null) {
        $("#" + DivId).append("<tr style='cursor:pointer;' >"
                + "<td style='cursor:pointer;'><label   >" + obj.chequeNo + "</select></td>"
                + "<td style='cursor:pointer;'><label>" + obj.chequeDate + "</label></td>"
                + "<td style='cursor:pointer;'><label>" + obj.chequeBankName + "</label></td>"
                + "<td style='cursor:pointer;'><label> " + obj.chequeAmount + "</label></td>"
                + "<td style='cursor:pointer;'><label> " + obj.inFavorOf + "</label></td>"
                + "<td style='cursor:pointer;'><label> " + obj.chequeRemarks + "</label></td>"
                + "</tr></thead>");
    }
}
function addBankDetailsVoucherRowsToUnPost(DivId, obj)
{
    obj = decodeURI(obj);
    obj = JSON.parse(obj);
    if (obj != null) {
        $("#" + DivId).append("<tr style='cursor:pointer;' >"
                + "<td style='cursor:pointer;'><label>" + obj.bankName + "</select></td>"
                + "<td style='cursor:pointer;'><label>" + obj.bankAccountNo + "</label></td>"
                + "<td style='cursor:pointer;'><label>" + obj.bankAmount + "</label></td>"
                + "<td style='cursor:pointer;'><label>" + obj.bankRemarks + "</label></td>"
                + "</tr></thead>");
    }
}
function UnpostThisVoucher(obj) {
    if (checkUserPrivelege(pvSaveVoucherUnPosting)) {
        obj = decodeURI(obj);
        obj = JSON.parse(obj);
        var pvId = obj.objId;
        var postingDate = $("#postingDate").val();
        // if (obj.voucherName == "PaymentVoucher") {
        var voucherName = obj.voucherName;
        $.post(server_base_url + "financial/transaction/VoucherUnPosting/ChangePostingStatus", {
            paymentVoucherJson: JSON.stringify(obj),
            userid: sessionStorage.getItem("userId"),
            pvId: pvId,
            postingDate: postingDate,
            voucherName: voucherName
        }).done(function (data) {
            if (data == fail) {
                displayErrorMessages("pregsuccessBefore", "Invalid username / password" + "");
            } else if (data == unauthorized || data.statuscode == unauthorized) {
                displayErrorMessages("pregsuccessBefore", unauthorizedMessage + "");
            } else if (data == statusException) {
                displayErrorMessages("pregsuccessBefore", statusExceptionMessage + "");
            } else if (data == invalidSession) {
                callSessionTimeout();
            } else if (data == null) {
                displayErrorMessages("pregsuccessBefore", "No User available" + "");
            } else {
                //$("#ErrorMessageDiv").text("").append("<center><div class='col-sm-12'  style='color:red;'><strong>Posted Succesfully.....<strong></div></center>");
                $("#ListPanel234").text("");
                displaySuccessMessages("ErrorMessageDiv", "UnPosted Succesfully...", "");
                setTimeout(function () {
                    viewUnPostingVoucherAddList();
                }, 1000);

                clearSuccessMessageAfterTwoSecond("ErrorMessageDiv");
                $("#postSearch").click();
            }
        });
//    } else if (obj.voucherName == "ReceiptVoucher") {
//        $.post(server_base_url + "financial/transaction/ReceiptVoucher/Update", {
//            receiptvoucherJson: JSON.stringify(obj),
//            userid: sessionStorage.getItem("userId"),
//            rvId: pvId
//        }).done(function(data) {
//            $("#ErrorMessageDiv").text("").append("<center><div class='col-sm-12'  style='color:red;'><strong>Posted Succesfully.....<strong></div></center>");
//            $("#ListPanel234").text("");
//            $("#postSearch").click();
//        });
//    } else if (obj.voucherName == "ContraVoucher") {
//        $.post(server_base_url + "financial/transaction/ContraVoucher/Update", {
//            contraVoucherJson: JSON.stringify(obj),
//            userid: sessionStorage.getItem("userId"),
//            cvId: pvId
//        }).done(function(data) {
//            $("#ErrorMessageDiv").text("").append("<center><div class='col-sm-12'  style='color:red;'><strong>Posted Succesfully.....<strong></div></center>");
//            $("#ListPanel234").text("");
//            $("#postSearch").click();
//        });
//    } else if (obj.voucherName == "JournalVoucher") {
//        $.post(server_base_url + "financial/transaction/JournalVoucher/Update", {
//            JournalVoucherJson: JSON.stringify(obj),
//            userid: sessionStorage.getItem("userId"),
//            jvId: pvId
//        }).done(function(data) {
//            $("#ErrorMessageDiv").text("").append("<center><div class='col-sm-12'  style='color:red;'><strong>Posted Succesfully.....<strong></div></center>");
//            $("#ListPanel234").text("");
//            $("#postSearch").click();
//        });
//    }
    }
}